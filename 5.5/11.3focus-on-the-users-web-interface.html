
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

    <meta name="baidu-site-verification" content="MfC8ppEukL" />
    <!-- CSRF Token -->
    <meta name="csrf-token" content="hm5989AA5qOWRt4SjRmpClu004h3pj4sKMT34pNa">

    <title>关注用户的网页界面 | 《Laravel 教程 - Web 开发实战入门 ( Laravel 5.5 )》 | Laravel 实战教程
    </title>

    <meta name="author" content="Summer" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <link rel="shortcut icon" href="../images/KDiyAbV0hj1ytHpRTOlVpucbLebonxeX.png"/>

    <!-- Styles -->
    <link href="../css/app.css" rel="stylesheet">
    <style>
        .ui.top.menu {border-top: 4px solid #f46660;}
    </style>
</head>
<body class=" books-articles-show-page">
<!--left-->
<div class="ui vertical  sidebar menu left" style="z-index: 99999">
    <div class="item">
        <b>Laravel 教程 - Web 开发实战入门 ( Laravel 5.5 )</b>
    </div>
    <div class="item">
        <div class="header">
            第一章. 基础信息
        </div>
        <div class="menu article">
            <a class="item" href="1.1about-the-book.html">1.1. 序言</a>
            <a class="item " href="1.2about-author.html">1.2. 关于作者</a>
            <a class="item " href="1.3laravel-and-php.html">1.3. Laravel 与 PHP</a>
            <a class="item " href="1.4reading-guide.html">1.4. 如何正确阅读本书？</a>
            <a class="item " href="1.5writing-convention.html">1.5. 写作约定</a>
            <a class="item " href="1.6release-notes.html">1.6. 发行说明</a>
            <a class="item " href="1.7the-book-source-code.html">1.7. 本书源码</a>
            <a class="item " href="1.8feedback-correction.html">1.8. 反馈纠错</a>
            <a class="item " href="1.9faq.html">1.9. 常见问题</a>
            <a class="item " href="1.10received-praise.html">1.10. 收到的赞誉</a>
        </div>
    </div>

    <div class="item">
        <div class="header">
            第二章. 开发环境布置
        </div>

        <div class="menu article">
            <a class="item " href="2.1the-editor-to-choose.html">2.1. 编辑器选用</a>
            <a class="item " href="2.2command-line-tool.html">2.2. 命令行工具</a>
            <a class="item " href="2.3the-development-environment-to-build.html">2.3. 开发环境搭建</a>
            <a class="item " href="2.4development-environment-macos.html">2.4. 开发环境搭建 - MacOS</a>
            <a class="item " href="2.5development-environment-windows.html">2.5. 开发环境搭建 - Windows</a>
            <a class="item " href="2.6browser-selection.html">2.6. 浏览器选择</a>
            <a class="item " href="2.7the-first-application-hello-laravel.html">2.7. 第一个应用，Hello Laravel！</a>
            <a class="item " href="2.8git-and-making.html">2.8. Git 与 GitHub</a>
            <a class="item " href="2.9the-deployment-of.html">2.9. 部署上线</a>
            <a class="item " href="2.10summary.html">2.10. 小结</a>
        </div>
    </div>

    <div class="item">
        <div class="header">
            第三章. 构建页面
        </div>
        <div class="menu article">
            <a class="item " href="3.1chapter.html">3.1. 章节说明</a>
            <a class="item " href="3.2create-an.html">3.2. 创建应用</a>
            <a class="item " href="3.3a-static-page.html">3.3. 静态页面</a>
            <a class="item " href="3.4artisan-command.html">3.4. Artisan 命令</a>
            <a class="item " href="3.5summary.html">3.5. 小结</a>
        </div>
    </div>

    <div class="item">
        <div class="header">
            第四章. 优化页面
        </div>
        <div class="menu article">
            <a class="item " href="4.1chapter.html">4.1. 章节说明</a>
            <a class="item " href="4.2style-beautification.html">4.2. 样式美化</a>
            <a class="item " href="4.3laravel-front-end-workflow.html">4.3. Laravel 前端工作流</a>
            <a class="item " href="4.4local-view.html">4.4. 局部视图</a>
            <a class="item " href="4.5the-links-in-the-layout.html">4.5. 布局中的链接</a>
            <a class="item " href="4.6user-registration.html">4.6. 用户注册页面</a>
            <a class="item " href="4.7summary.html">4.7. 小结</a>
        </div>
    </div>

    <div class="item">
        <div class="header">
            第五章. 用户模型
        </div>
        <div class="menu article">
            <a class="item " href="5.1chapter.html">5.1. 章节说明</a>
            <a class="item " href="5.2database-migration.html">5.2. 数据库迁移</a>
            <a class="item " href="5.3check-the-database-table.html">5.3. 查看数据库表</a>
            <a class="item " href="5.4model-file.html">5.4. 模型文件</a>
            <a class="item " href="5.5create-a-user-object.html">5.5. 创建用户对象</a>
            <a class="item " href="5.6to-find-the-user-object.html">5.6. 查找用户对象</a>
            <a class="item " href="5.7update-user-object.html">5.7. 更新用户对象</a>
            <a class="item " href="5.8summary.html">5.8. 小结</a>
        </div>
    </div>

    <div class="item">
        <div class="header">
            第六章. 用户注册
        </div>
        <div class="menu article">
            <a class="item " href="6.1chapter.html">6.1. 章节说明</a>
            <a class="item " href="6.2according-to-the-users-information.html">6.2. 显示用户的信息</a>
            <a class="item " href="6.3registration-form.html">6.3. 注册表单</a>
            <a class="item " href="6.4the-user-data-validation.html">6.4. 用户数据验证</a>
            <a class="item " href="6.5registration-failed-error-message.html">6.5. 注册失败错误消息</a>
            <a class="item " href="6.6registered-successfully.html">6.6. 注册成功</a>
            <a class="item " href="6.7using-postgresql-on-heroku.html">6.7. 在 Heroku 上使用 PostgreSQL</a>
            <a class="item " href="6.8summary.html">6.8. 小结</a>
        </div>
    </div>

    <div class="item">
        <div class="header">
            第七章. 会话管理
        </div>
        <div class="menu article">
            <a class="item " href="7.1chapter.html">7.1. 章节说明</a>
            <a class="item " href="7.2the-session.html">7.2. 会话</a>
            <a class="item " href="7.3the-user-login.html">7.3. 用户登录</a>
            <a class="item " href="7.4exit.html">7.4. 退出</a>
            <a class="item " href="7.5remember-that-i.html">7.5. 记住我</a>
            <a class="item " href="7.6summary.html">7.6. 小结</a>
        </div>
    </div>

    <div class="item">
        <div class="header">
            第八章. 用户 CRUD
        </div>
        <div class="menu article">
            <a class="item " href="8.1chapter.html">8.1. 章节说明</a>
            <a class="item " href="8.2update-user.html">8.2. 更新用户</a>
            <a class="item " href="8.3permissions-system.html">8.3. 权限系统</a>
            <a class="item " href="8.4list-all-user.html">8.4. 列出所有用户</a>
            <a class="item " href="8.5delete-user.html">8.5. 删除用户</a>
            <a class="item " href="8.6summary.html">8.6. 小结</a>
        </div>
    </div>

    <div class="item">
        <div class="header">
            第九章. 邮件发送
        </div>
        <div class="menu article">
            <a class="item " href="9.1chapter.html">9.1. 章节说明</a>
            <a class="item " href="9.2account-activation.html">9.2. 账户激活</a>
            <a class="item " href="9.3password-reset.html">9.3. 密码重设</a>
            <a class="item " href="9.4in-a-production-environment-to-send-mail.html">9.4. 在生产环境中发送邮件</a>
            <a class="item " href="9.5summary.html">9.5. 小结</a>
        </div>
    </div>

    <div class="item">
        <div class="header">
            第十章. 微博 CRUD
        </div>
        <div class="menu article">
            <a class="item " href="10.1chapter.html">10.1. 章节说明</a>
            <a class="item " href="10.2weibo-model.html">10.2. 微博模型</a>
            <a class="item " href="10.3according-to-weibo.html">10.3. 显示微博</a>
            <a class="item " href="10.4weibo-related-operations.html">10.4. 微博相关的操作</a>
            <a class="item " href="10.5summary.html">10.5. 小结</a>
        </div>
    </div>

    <div class="item">
        <div class="header">
            第十一章. 粉丝关系
        </div>
        <div class="menu article">
            <a class="item " href="11.1chapter.html">11.1. 章节说明</a>
            <a class="item " href="11.2fan-data-table.html">11.2. 粉丝数据表</a>
            <a class="item active" href="11.3focus-on-the-users-web-interface.html">11.3. 关注用户的网页界面</a>
            <a class="item " href="11.4dynamic-flow.html">11.4. 动态流</a>
            <a class="item " href="11.5summary.html">11.5. 小结</a>
        </div>
    </div>

    <div class="item">
        <div class="header">
            第十二章. 附录
        </div>
        <div class="menu article">
            <a class="item " href="12.1proper-noun-index.html">12.1. 专有名词索引</a>
            <a class="item " href="12.2command-line-index.html">12.2. 命令行索引</a>
        </div>
    </div>

    <div class="item">
        <div class="header">
            第十三章. 附言
        </div>
        <div class="menu article">
            <a class="item " href="13.1the-next-step-study-suggest.html">13.1. 下一步的学习建议</a>
        </div>
    </div>
</div>
<!--left-->

<div class="ui basic teal  launch right attached fixed button">
    <i class="content icon"></i>
    <span class="text">Menu</span>
</div>

<div class="pusher">

    <div class="main container">

        <nav class="ui main borderless menu top stackable">
            <div class="ui container">
                <a href="../index.html" class="header item">
                    Laravel 实战教程 <div class="ui left pointing orange basic label" style="font-weight: normal;"> 全栈给我自由 </div>
                </a>


                <a href="https://laravel-china.org/topics" class="item no-pjax" >社区</a>
                <a href="https://laravel-china.org/categories/4" class="item">问答</a>

                <div class="ui fluid category search item">
                    <div class="ui icon input">
                        <input class="prompt" type="text" placeholder="">
                        <i class="search icon"></i>
                    </div>
                    <div class="results"></div>
                </div>


                <div class=" right menu stackable">
                    <div class="item">
                        <a class="ui basic green small button" href="https://laravel-china.org/auth/login"><i class="icon user "></i> 登录 </a>
                    </div>

                    <div class="item">
                        <a class="ui basic green small button" href="https://laravel-china.org/auth/register"><i class="icon signup "></i> 注册 </a>
                    </div>
                </div>

            </div>
        </nav>




        <div class="ui centered grid container stackable">

            <div class="twelve wide column">


                <div class="ui segment article-content">


                    <div class="extra-padding">

                        <h1>
                            <i class="grey file text outline icon"></i>
                            <span style="line-height: 34px;">11.3. 关注用户的网页界面 </span>





                        </h1>

                        <p class="book-article-meta">

                            <a href="../index.html"><i class="icon book"></i> Laravel 教程 - Web 开发实战入门 ( Laravel 5.5 )</a>

                            <span class="divider">/</span>

                            <span class="relative clicked-hide-guide">
                <a class="chapter-title user-has-done-btn" data-act="chapter_sidebar_clicked" href="javascript:void(0);"><i class="icon map signs"></i> 第十一章. 粉丝关系</a>
    </span>

                        </p>



                        <div class="ui divider"></div>

                        <div class="ui readme markdown-body content-body">
                            <h2>关注用户的网页界面</h2>
                            <p>现在我们已经实现了用户关注功能的主要工具方法，并且能够通过用户来获取到他的粉丝列表和关注人列表。</p>
                            <p>接下来让我们先着手视图的构建，在页面上显示粉丝列表和关注人列表，并在用户的个人页面添加上一个关注按钮，方便其他用户对其进行关注。</p>
                            <h2>示例数据</h2>
                            <p>目前并没有一个用户拥有大量的粉丝或关注了多个人，接下来我们需要用数据填充的方式，为第一个用户添加假数据，让他拥有一些关注人和粉丝。</p>
                            <p>首先我们需要生成一个数据填充文件。</p>
                            <pre><code class="language-bash">$ php artisan make:seeder FollowersTableSeeder</code></pre>
                            <p>我们会使用第一个用户对除自己以外的用户进行关注，接着再让所有用户去关注第一个用户。假数据的生成代码如下所示：</p>
                            <p><em>database/seeds/FollowersTableSeeder.php</em></p>
                            <pre><code class="language-php">&lt;?php

use Illuminate\Database\Seeder;
use App\Models\User;

class FollowersTableSeeder extends Seeder
{
    /**
     * Run the database seeds.
     *
     * @return void
     */
    public function run()
    {
        $users = User::all();
        $user = $users-&gt;first();
        $user_id = $user-&gt;id;

        // 获取去除掉 ID 为 1 的所有用户 ID 数组
        $followers = $users-&gt;slice(1);
        $follower_ids = $followers-&gt;pluck('id')-&gt;toArray();

        // 关注除了 1 号用户以外的所有用户
        $user-&gt;follow($follower_ids);

        // 除了 1 号用户以外的所有用户都来关注 1 号用户
        foreach ($followers as $follower) {
            $follower-&gt;follow($user_id);
        }
    }
}</code></pre>
                            <p>接着让我们为假数据的生成顺序进行设定。</p>
                            <p><em>database/seeds/DatabaseSeeder.php</em></p>
                            <pre><code class="language-php">&lt;?php

use Illuminate\Database\Seeder;
use Illuminate\Database\Eloquent\Model;

class DatabaseSeeder extends Seeder
{
    /**
     * Run the database seeds.
     *
     * @return void
     */
    public function run()
    {
        Model::unguard();

        $this-&gt;call(UsersTableSeeder::class);
        $this-&gt;call(StatusesTableSeeder::class);
        $this-&gt;call(FollowersTableSeeder::class);

        Model::reguard();
    }
}</code></pre>
                            <p>最后，我们还需要对数据库进行重置和填充。</p>
                            <pre><code class="language-bash">$ php artisan migrate:refresh --seed</code></pre>
                            <h2>『关注的人』列表页面和『粉丝』列表页面</h2>
                            <p>现在假数据已填充完毕，接下来让我们接着定义用户关注者列表和粉丝列表的路由，用于对接下来的关注人列表和粉丝列表进行显示。</p>
                            <p><em>routes/web.php</em></p>
                            <pre><code class="language-php">&lt;?php
.
.
.

Route::get('/users/{user}/followings', 'UsersController@followings')-&gt;name('users.followings');
Route::get('/users/{user}/followers', 'UsersController@followers')-&gt;name('users.followers');</code></pre>
                            <p>该路由列表信息如下所示：</p>
                            <table><thead><tr><th>HTTP 请求</th>
                                <th>URL</th>
                                <th>动作</th>
                                <th>作用</th>
                            </tr></thead><tbody><tr><td>GET</td>
                                <td>/users/{user}/followings</td>
                                <td>UsersController@followings</td>
                                <td>显示用户的关注人列表</td>
                            </tr><tr><td>GET</td>
                                <td>/users/{user}/followers</td>
                                <td>UsersController@followers</td>
                                <td>显示用户的粉丝列表</td>
                            </tr></tbody></table>

                            <p>可以看到两个新增的路由都被映射到用户控制器上，因此我们接下来需要对控制器加入两个方法，一个是用于显示用户关注人列表视图的 <code>followings</code> 方法，另一个则是用户显示粉丝列表的 <code>followers</code> 方法。接着我们还需要对这两个动作的请求进行过滤，只允许登录用户访问，得益于我们使用了 <code>auth</code> 中间件的 <code>except</code> 选项，这里我们不需要做任何修改，此控制器默认安全。完整的代码如下。</p>
                            <p><em>app/Http/Controllers/UsersController.php</em></p>
                            <pre><code class="language-php">&lt;?php
namespace App\Http\Controllers;
.
.
.
class UsersController extends Controller
{
    .
    .
    .
    public function followings(User $user)
    {
        $users = $user-&gt;followings()-&gt;paginate(30);
        $title = '关注的人';
        return view('users.show_follow', compact('users', 'title'));
    }

    public function followers(User $user)
    {
        $users = $user-&gt;followers()-&gt;paginate(30);
        $title = '粉丝';
        return view('users.show_follow', compact('users', 'title'));
    }
}</code></pre>
                            <p>由上面代码可知，我们在新增的两个动作中添加了 <code>title</code> 变量用于网页标题的显示，这是因为我们最终构建出来的关注人列表视图和粉丝视图除了显示的动态数据和标题可能有些不同，其它的页面元素基本一致，为了避免写重复代码，我们将对这两份数据使用同一套视图进行展示。由 <code>view</code> 方法传送的参数可知，我们接下来需要新增一个 <code>users/show_follow</code> 视图来用于数据展示。该视图的页面结构如下。</p>
                            <p><em>resources/views/users/show_follow.blade.php</em></p>
                            <pre><code class="language-html">@extends('layouts.default')
@section('title', $title)

@section('content')
&lt;div class="col-md-offset-2 col-md-8"&gt;
  &lt;h1&gt;{{ $title }}&lt;/h1&gt;
  &lt;ul class="users"&gt;
    @foreach ($users as $user)
      &lt;li&gt;
        &lt;img src="{{ $user-&gt;gravatar() }}" alt="{{ $user-&gt;name }}" class="gravatar"/&gt;
        &lt;a href="{{ route('users.show', $user-&gt;id )}}" class="username"&gt;{{ $user-&gt;name }}&lt;/a&gt;
      &lt;/li&gt;
    @endforeach
  &lt;/ul&gt;

  {!! $users-&gt;render() !!}
&lt;/div&gt;
@stop</code></pre>
                            <p>这一步操作完成之后，我们便能够在页面上查看用户的 <a href="http://sample.test/users/1/followings">关注人列表</a> 和 <a href="http://sample.test/users/1/followers">粉丝列表</a>。</p><p>
                            <img class="rm-style" src="../images/j5Mmd11iDC.png" alt="j5Mmd11iDC.png" /></p>

                            <p>接着我们还需要再添加一个局部视图，用于展示用户的一些社交的统计信息，如关注人数、粉丝数、微博发布数等。</p>
                            <p><em>resources/views/shared/_stats.blade.php</em></p>
                            <pre><code class="language-html">&lt;div class="stats"&gt;
  &lt;a href="{{ route('users.followings', $user-&gt;id) }}"&gt;
    &lt;strong id="following" class="stat"&gt;
      {{ count($user-&gt;followings) }}
    &lt;/strong&gt;
    关注
  &lt;/a&gt;
  &lt;a href="{{ route('users.followers', $user-&gt;id) }}"&gt;
    &lt;strong id="followers" class="stat"&gt;
      {{ count($user-&gt;followers) }}
    &lt;/strong&gt;
    粉丝
  &lt;/a&gt;
  &lt;a href="{{ route('users.show', $user-&gt;id) }}"&gt;
    &lt;strong id="statuses" class="stat"&gt;
      {{ $user-&gt;statuses()-&gt;count() }}
    &lt;/strong&gt;
    微博
  &lt;/a&gt;
&lt;/div&gt;</code></pre>
                            <p>我们通过调用 Eloquent 模型的 <code>count</code> 方法来获取用户发布过的微博数，这个做法并不算是最佳实践，因为在大型应用中，为了节省服务器资源，优化数据库查询效率，常会采用的方法是在数据库中添加一个模型计数器字段，在每次对模型进行创建或删除时对该字段进行更新，而由于本书开发的应用只是小型的演示应用，因此在这里我们使用 <code>count</code> 方法来查询即可。</p>
                            <pre><code class="language-php">{{ $user-&gt;statuses()-&gt;count() }}</code></pre>
                            <p>在定义好用户个人信息的统计视图之后，我们需要将视图添加到首页上进行显示。</p>
                            <p><em>resources/views/static_pages/home.blade.php</em></p>
                            <pre><code class="language-html">@extends('layouts.default')

@section('content')
  @if (Auth::check())
    &lt;div class="row"&gt;
      &lt;div class="col-md-8"&gt;
        &lt;section class="status_form"&gt;
          @include('shared._status_form')
        &lt;/section&gt;
        &lt;h3&gt;微博列表&lt;/h3&gt;
        @include('shared._feed')
      &lt;/div&gt;
      &lt;aside class="col-md-4"&gt;
        &lt;section class="user_info"&gt;
          @include('shared._user_info', ['user' =&gt; Auth::user()])
        &lt;/section&gt;
        &lt;section class="stats"&gt;
          @include('shared._stats', ['user' =&gt; Auth::user()])
        &lt;/section&gt;
      &lt;/aside&gt;
    &lt;/div&gt;
  @else
    &lt;div class="jumbotron"&gt;
      &lt;h1&gt;Hello Laravel&lt;/h1&gt;
      &lt;p class="lead"&gt;
        你现在所看到的是 &lt;a href="https://laravel-china.org/laravel-tutorial/5.1"&gt;Laravel 入门教程&lt;/a&gt; 的项目主页。
      &lt;/p&gt;
      &lt;p&gt;
        一切，将从这里开始。
      &lt;/p&gt;
      &lt;p&gt;
        &lt;a class="btn btn-lg btn-success" href="{{ route('signup') }}" role="button"&gt;现在注册&lt;/a&gt;
      &lt;/p&gt;
    &lt;/div&gt;
  @endif
@stop</code></pre>
                            <p>接着让我们来对样式进行调整，让页面看上去能更加整洁美观。</p>
                            <p><em>resources/assets/sass/app.scss</em></p>
                            <pre><code class="language-scss">.
.
.
/* sidebar */
.
.
.
.stats {
  overflow: auto;
  margin-top: 0;
  padding: 0;
  a {
    float: left;
    padding: 0 10px;
    text-align: center;
    width: 33%;
    border-left: 1px solid $gray-lighter;
    color: gray;
    &amp;:first-child {
      padding-left: 0;
      border: 0;
    }
    &amp;:hover {
      text-decoration: none;
      color: #337ab7;
    }
  }
  strong {
    display: block;
    font-size: 1.2em;
    color: black;
  }
}

.user_avatars {
  overflow: auto;
  margin-top: 10px;
  .gravatar {
    margin: 1px 1px;
  }
  a {
    padding: 0;
  }
}

.users.follow {
  padding: 0;
}

/* forms */

#follow_form button {
  margin: 0 auto;
  display: block;
  margin-top: 25px;
}
.
.
.</code></pre>
                            <p>在做完这一切之后，我们便能够在首页看到社交统计视图已经能够正常显示出来了。</p>
                            <p><img src="../images/7CT0SXF3cg.png" alt="file" /></p>
                            <h2>关注表单</h2>
                            <h3>添加路由</h3>
                            <p>接下来让我们针对前面开发的「关注用户」和「取消用户」的功能，加入路由定义。</p>
                            <p><em>routes/web.php</em></p>
                            <pre><code class="language-php">&lt;?php

.
.
.

Route::post('/users/followers/{user}', 'FollowersController@store')-&gt;name('followers.store');
Route::delete('/users/followers/{user}', 'FollowersController@destroy')-&gt;name('followers.destroy');</code></pre>
                            <p>对应的路由信息如下：</p>
                            <table><thead><tr><th>HTTP 请求</th>
                                <th>URL</th>
                                <th>动作</th>
                                <th>作用</th>
                            </tr></thead><tbody><tr><td>POST</td>
                                <td>/users/followers/{user}</td>
                                <td>FollowersController@store</td>
                                <td>关注用户</td>
                            </tr><tr><td>DELETE</td>
                                <td>/users/followers/{user}</td>
                                <td>FollowersController@destroy</td>
                                <td>取消关注用户</td>
                            </tr></tbody></table>

                            <p>可以看到，两个路由的动作都映射到了 <code>FollowersController</code> 控制器上，目前该控制器还没有创建，让我们运行下面命令进行创建。</p>
                            <pre><code class="language-bash">$ php artisan make:controller FollowersController</code></pre>
                            <p>接下来我们需要在用户个人页面上增加一个关注表单，表单以按钮的形式展现，点击按钮即可对用户进行关注。关注表单的页面结构如下：</p>
                            <p><em>resources/views/users/_follow_form.blade.php</em></p>
                            <pre><code class="language-html">@if ($user-&gt;id !== Auth::user()-&gt;id)
  &lt;div id="follow_form"&gt;
    @if (Auth::user()-&gt;isFollowing($user-&gt;id))
      &lt;form action="{{ route('followers.destroy', $user-&gt;id) }}" method="post"&gt;
        {{ csrf_field() }}
        {{ method_field('DELETE') }}
        &lt;button type="submit" class="btn btn-sm"&gt;取消关注&lt;/button&gt;
      &lt;/form&gt;
    @else
      &lt;form action="{{ route('followers.store', $user-&gt;id) }}" method="post"&gt;
        {{ csrf_field() }}
        &lt;button type="submit" class="btn btn-sm btn-primary"&gt;关注&lt;/button&gt;
      &lt;/form&gt;
    @endif
  &lt;/div&gt;
@endif</code></pre>
                            <p>当用户访问的是自己的个人页面时，关注表单不应该被显示出来，因此我们加了下面这行代码用于判断：</p>
                            <pre><code class="language-html">$user-&gt;id !== Auth::user()-&gt;id</code></pre>
                            <h3>关注状态</h3>
                            <p>接着，关注表单需要分为两种状态进行显示：</p>
                            <ol><li>当用户已被关注时，显示的是取消关注的按钮；</li>
                                <li>未被关注时，使用的则是关注按钮。</li>
                            </ol>

                            <p>我们可以通过在用户模型中定义的 <code>isFollowing</code> 方法来判断用户是否已被关注。</p>
                            <pre><code class="language-html">Auth::user()-&gt;isFollowing($user-&gt;id)</code></pre>
                            <p>现在让我们将创建好的关注表单添加到用户的个人页面上，另外用户的社交信息统计视图也需要在其个人页面上得到展示。</p>
                            <p>为用户个人页面添加关注表单和信息统计视图：</p>
                            <p><em>resources/views/users/show.blade.php</em></p>
                            <pre><code class="language-html">@extends('layouts.default')
@section('title', $user-&gt;name)
@section('content')
&lt;div class="row"&gt;
  &lt;div class="col-md-offset-2 col-md-8"&gt;
    &lt;div class="col-md-12"&gt;
      &lt;div class="col-md-offset-2 col-md-8"&gt;
        &lt;section class="user_info"&gt;
          @include('shared._user_info', ['user' =&gt; $user])
        &lt;/section&gt;
        &lt;section class="stats"&gt;
          @include('shared._stats', ['user' =&gt; $user])
        &lt;/section&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="col-md-12"&gt;
      @if (Auth::check())
        @include('users._follow_form')
      @endif

      @if (count($statuses) &gt; 0)
        &lt;ol class="statuses"&gt;
          @foreach ($statuses as $status)
            @include('statuses._status')
          @endforeach
        &lt;/ol&gt;
        {!! $statuses-&gt;render() !!}
      @endif
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
@stop</code></pre>
                            <p>由于我们并没有对用户个人页面对应的请求进行过滤，因此未登录的用户也能查看其它用户的个人信息，当未登录用户访问了个人页面时，则不需要渲染关注表单。通过前面所学的知识可知，我们能通过 <code>Auth::check()</code> 方法来判断用户是否已登录。</p>
                            <h2>关注功能的逻辑处理</h2>
                            <p>现在的用户关注表单已经构建完毕，接下来让我们为 <code>FollowersController</code> 加上 <code>store</code> 和 <code>destroy</code> 动作，分别用于处理「关注」和「取消关注」用户的请求。</p>
                            <p><em>app/Http/Controllers/FollowersController.php</em></p>
                            <pre><code class="language-php">&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Http\Requests;
use App\Models\User;
use Auth;

class FollowersController extends Controller
{
    public function __construct()
    {
        $this-&gt;middleware('auth');
    }

    public function store(User $user)
    {
        if (Auth::user()-&gt;id === $user-&gt;id) {
            return redirect('/');
        }

        if (!Auth::user()-&gt;isFollowing($user-&gt;id)) {
            Auth::user()-&gt;follow($user-&gt;id);
        }

        return redirect()-&gt;route('users.show', $user-&gt;id);
    }

    public function destroy(User $user)
    {
        if (Auth::user()-&gt;id === $user-&gt;id) {
            return redirect('/');
        }

        if (Auth::user()-&gt;isFollowing($user-&gt;id)) {
            Auth::user()-&gt;unfollow($user-&gt;id);
        }

        return redirect()-&gt;route('users.show', $user-&gt;id);
    }
}</code></pre>
                            <p>由于这两个动作都需要用户登录之后才能进行操作，因此我们为这两个动作都加上请求过滤。由于用户不能对自己进行关注和取消关注，因此我们在 <code>store</code> 和 <code>destroy</code> 方法中都对用户身份做了判断，当执行关注和取消关注的用户对应的是当前的用户时，重定向到首页。</p>
                            <pre><code class="language-php">if (Auth::user()-&gt;id === $user-&gt;id) {
    return redirect('/');
}</code></pre>
                            <p>为了使代码逻辑更加严谨，在进行关注和取消关注操作之前，我们还会利用 <code>isFollowing</code> 方法来判断当前用户是否已关注了要进行操作的用户。</p>
                            <p>至此用户的关注功能已能正常工作。</p>
                            <p><img src="../images/glF6rrnBSi.gif" alt="file" /></p>
                        </div>

                    </div>


                </div>

                <div>
                    <a class="ui basic button small  pull-left popover " data-content="11.2. 粉丝数据表" href="11.2fan-data-table.html"><i class="icon arrow left"></i> 上一篇</a>
                    <a class="ui basic button small  pull-right popover " data-content="11.4. 动态流" href="11.4dynamic-flow.html">下一篇 <i class="icon arrow right"></i></a>
                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="four wide column">
                <div class="item header">

                    <div class="ui segment orange text-center" style="padding: 25px;">
                        刻意练习，每日精进。
                    </div>


                    <div class="ui segment">

                        <div class="ui three statistics">
                            <div class="ui huge statistic">
                                <div class="value">22</div>
                                <div class="label">点赞</div>
                            </div>
                            <div class="ui huge statistic">
                                <div class="value">9179</div>
                                <div class="label">浏览</div>
                            </div>
                            <div class="ui huge statistic">
                                <div class="value">1</div>
                                <div class="label">评论</div>
                            </div>
                        </div>

                        <br>

                    </div>
                </div>

                <div class="ui stackable cards">
                    <div class="ui  card column author-box grid" style="margin-top: 20px;">

                        <div class="ui fluid" style="margin-top: 20px;">
                            <div class="ui teal ribbon label"><i class="star icon"></i> 作者</div>
                        </div>

                        <a class="avatar-link">
                            <img class="ui centered circular tiny image "
                                 src="../images/1_1479342408.png">
                            </img>
                        </a>

                        <div class="extra content ui center aligned container">
                            <a class="header">Summer</a>
                            <div class="description"></div>
                        </div>
                    </div>
                </div>

                <div class="ui sticky" style="padding-top:20px">
                    <div class="ui  card column author-box grid " id="toc">
                    </div>
                </div>
            </div>

        </div>

    </div>

    <a class="circular ui icon button fixed feedback popover" data-content="建议与反馈 @Summer" data-position="left center">
        <i class="icon talk outline"></i>
    </a>

    <div class="ui inverted vertical footer segment">
        <div class="ui center aligned container">
            <div class="ui stackable inverted divided grid">
                <div class="four wide column">
                    <h4 class="ui inverted header">友站</h4>
                    <div class="ui inverted link list">
                        <a href="https://laravel-china.org/" class="item" target="_blank">Laravel China 社区</a>
                        <a href="https://easywechat.org/" class="item" target="_blank">EasyWechat</a>
                        <a href="https://yousails.com/" class="item" target="_blank">优帆远扬</a>
                    </div>
                </div>
                <div class="four wide column">
                    <h4 class="ui inverted header">资源推荐</h4>
                    <div class="ui inverted link list">
                        <a href="https://d.laravel-china.org/" class="item" target="_blank">Laravel 中文文档</a>
                        <a href="https://cs.laravel-china.org/" class="item" target="_blank">Laravel 速查表</a>
                    </div>
                </div>
                <div class="eight wide column">
                    <h4 class="ui inverted  header">Laravel 实战教程</h4>
                    <p>
                        编程是技能，不是知识，技能的唯一学习路径就是重复、实战性练习。
                    </p>

                    <p>
                        <a class="ui teal button" href="https://laravel-china.org/contact"><i class="icon idea "></i>
                            联系我
                        </a>
                    </p>
                </div>
            </div>

            <div class="ui inverted section divider"></div>
            <div>

                <p style="font-size:0.9em; margin-top:20px;margin-bottom: -8px;color: rgb(137, 137, 140);"
                   class="ui inverted ">
                    由 <a href="http://weibo.com/u/1837553744?is_hot=1" target="_blank"
                         style="color: inherit;">Summer</a> 设计和编码 <span style="color: #e27575;font-size: 14px;">❤</span>
                </p>
            </div>
        </div>
    </div>
</div>


<!-- Scripts -->
<script src="../js/app.js"></script>

</body>
</html>
